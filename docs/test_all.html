<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FULIFE - All Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        
        h1, h2 {
            text-align: center;
            color: #ff9900;
        }
        
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #333;
            border-radius: 5px;
        }
        
        .test-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .test-link {
            background-color: #555;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-decoration: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .test-link:hover {
            background-color: #666;
        }
        
        .test-link .description {
            font-size: 0.9em;
            color: #ccc;
        }
        
        .direct-tests {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #console {
            padding: 10px;
            background-color: #222;
            border: 1px solid #444;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            margin-top: 20px;
            max-width: 800px;
            margin: 20px auto;
        }
        
        .log {
            margin: 5px 0;
        }
        
        .log-info {
            color: #4CAF50;
        }
        
        .log-error {
            color: #f44336;
        }
        
        .log-warn {
            color: #ff9800;
        }
        
        #test-frame {
            width: 100%;
            height: 400px;
            border: 1px solid #444;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>FULIFE - All Tests</h1>
    
    <div class="test-section">
        <h2>Test Pages</h2>
        <div class="test-links">
            <a href="test_game.html" class="test-link" target="_blank">
                <span>Game.js Test</span>
                <span class="description">Tests the core gameplay functions</span>
            </a>
            <a href="test_start.html" class="test-link" target="_blank">
                <span>Start.js Test</span>
                <span class="description">Tests the menu and cutscene system</span>
            </a>
            <a href="test_logic_gates.html" class="test-link" target="_blank">
                <span>Logic Gates Test</span>
                <span class="description">Tests the logic gate minigame</span>
            </a>
            <a href="test_cutscenes.html" class="test-link" target="_blank">
                <span>Cutscenes Test</span>
                <span class="description">Tests the cutscene system</span>
            </a>
            <a href="index.html" class="test-link" target="_blank">
                <span>Full Game</span>
                <span class="description">Run the complete game</span>
            </a>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Direct Function Tests</h2>
        <div class="direct-tests">
            <button onclick="testImageLoading()">Test Image Loading</button>
            <button onclick="testCanvasCreation()">Test Canvas Creation</button>
            <button onclick="testSpriteCreation()">Test Sprite Creation</button>
            <button onclick="testGameStateTransition()">Test Game State</button>
            <button onclick="testPlayerInitialization()">Test Player Init</button>
            <button onclick="testDomElements()">Test DOM Elements</button>
            <button onclick="checkResourceAvailability()">Check Resources</button>
            <button onclick="runBlackScreenTests()">Test Blank Screen Issues</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console"></div>
    </div>
    
    <iframe id="test-frame" frameborder="0"></iframe>
    
    <!-- Include necessary game files for testing -->
    <script src="images.js"></script>
    
    <!-- Test script -->
    <script>
        // Override console methods to capture in our console div
        const consoleDiv = document.getElementById('console');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };
        
        console.log = function(message) {
            originalConsole.log.apply(console, arguments);
            const logItem = document.createElement('div');
            logItem.className = 'log log-info';
            logItem.textContent = typeof message === 'object' ? JSON.stringify(message) : message;
            consoleDiv.appendChild(logItem);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.error = function(message) {
            originalConsole.error.apply(console, arguments);
            const logItem = document.createElement('div');
            logItem.className = 'log log-error';
            logItem.textContent = typeof message === 'object' ? JSON.stringify(message) : message;
            consoleDiv.appendChild(logItem);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.warn = function(message) {
            originalConsole.warn.apply(console, arguments);
            const logItem = document.createElement('div');
            logItem.className = 'log log-warn';
            logItem.textContent = typeof message === 'object' ? JSON.stringify(message) : message;
            consoleDiv.appendChild(logItem);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        // Test functions
        function testImageLoading() {
            console.log("Testing image loading...");
            
            // Check if IMAGES object exists and has properties
            if (typeof IMAGES === 'undefined') {
                console.error("IMAGES object is not defined. images.js might not be loaded correctly.");
                return;
            }
            
            console.log("IMAGES object found. Properties:", Object.keys(IMAGES));
            
            // Try to load an image
            const testImg = new Image();
            testImg.onload = function() {
                console.log("Test image loaded successfully!");
            };
            testImg.onerror = function() {
                console.error("Failed to load test image");
            };
            
            // Try to use a sprite from IMAGES if available
            if (IMAGES.playerSprite) {
                testImg.src = IMAGES.playerSprite;
                console.log("Using playerSprite from IMAGES object");
            } else if (IMAGES.jobBuilding) {
                testImg.src = IMAGES.jobBuilding;
                console.log("Using jobBuilding from IMAGES object");
            } else {
                console.warn("No suitable test image found in IMAGES");
                // Create a simple test image
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 100;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = 'red';
                ctx.fillRect(0, 0, 100, 100);
                testImg.src = canvas.toDataURL();
                console.log("Created a test image");
            }
        }
        
        function testCanvasCreation() {
            console.log("Testing canvas creation...");
            
            // Create a test canvas
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 200;
            
            // Get context
            try {
                const ctx = canvas.getContext('2d');
                console.log("Canvas context created successfully");
                
                // Draw something
                ctx.fillStyle = 'blue';
                ctx.fillRect(50, 50, 100, 100);
                
                console.log("Canvas drawing successful");
                
                // Show the canvas (optional)
                canvas.style.position = 'absolute';
                canvas.style.top = '20px';
                canvas.style.right = '20px';
                canvas.style.zIndex = '100';
                canvas.style.border = '2px solid white';
                document.body.appendChild(canvas);
                
                // Remove the canvas after 3 seconds
                setTimeout(() => {
                    document.body.removeChild(canvas);
                }, 3000);
            } catch (error) {
                console.error("Error creating canvas context:", error);
            }
        }
        
        function testSpriteCreation() {
            console.log("Testing sprite creation...");
            
            // Create a simple sprite sheet
            const canvas = document.createElement('canvas');
            canvas.width = 432;
            canvas.height = 576; // 4 rows, 3 columns = 12 frames
            const ctx = canvas.getContext('2d');
            
            // Draw some rectangles to simulate a sprite sheet
            const frameWidth = 108;
            const frameHeight = 144;
            
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    // Alternate colors
                    ctx.fillStyle = (row + col) % 2 === 0 ? 'blue' : 'green';
                    ctx.fillRect(col * frameWidth, row * frameHeight, frameWidth, frameHeight);
                    
                    // Draw frame number
                    ctx.fillStyle = 'white';
                    ctx.font = '24px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`F${row * 4 + col + 1}`, col * frameWidth + frameWidth / 2, row * frameHeight + frameHeight / 2);
                }
            }
            
            const spriteSheet = canvas.toDataURL();
            console.log("Sprite sheet created successfully");
            
            // Create an image to test the sprite sheet
            const img = new Image();
            img.onload = function() {
                console.log("Sprite image loaded successfully");
                
                // Display the sprite sheet
                const displayCanvas = document.createElement('canvas');
                displayCanvas.width = frameWidth;
                displayCanvas.height = frameHeight;
                const displayCtx = displayCanvas.getContext('2d');
                
                displayCanvas.style.position = 'absolute';
                displayCanvas.style.top = '20px';
                displayCanvas.style.right = '20px';
                displayCanvas.style.zIndex = '100';
                displayCanvas.style.border = '2px solid white';
                document.body.appendChild(displayCanvas);
                
                // Animate the sprite
                let frame = 0;
                let row = 0;
                
                function animateSprite() {
                    displayCtx.clearRect(0, 0, frameWidth, frameHeight);
                    displayCtx.drawImage(
                        img,
                        frame * frameWidth, row * frameHeight, frameWidth, frameHeight,
                        0, 0, frameWidth, frameHeight
                    );
                    
                    frame = (frame + 1) % 4;
                    if (frame === 0) {
                        row = (row + 1) % 4;
                    }
                }
                
                const animInterval = setInterval(animateSprite, 200);
                
                // Stop animation and remove canvas after 5 seconds
                setTimeout(() => {
                    clearInterval(animInterval);
                    document.body.removeChild(displayCanvas);
                }, 5000);
            };
            
            img.onerror = function() {
                console.error("Error loading sprite image");
            };
            
            img.src = spriteSheet;
        }
        
        function testGameStateTransition() {
            console.log("Testing game state transitions...");
            
            // Create a mock game state
            let gameState = "mainMenu";
            console.log("Initial game state:", gameState);
            
            // Test state transitions
            function transitionTo(newState) {
                console.log(`Transitioning from ${gameState} to ${newState}`);
                gameState = newState;
            }
            
            // Simulate game flow
            transitionTo("customization");
            transitionTo("cutscene");
            transitionTo("gameplay");
            transitionTo("minigame");
            transitionTo("gameplay");
            
            console.log("Final game state:", gameState);
            console.log("Game state transitions completed successfully");
        }
        
        function testPlayerInitialization() {
            console.log("Testing player initialization...");
            
            // Create a mock player object
            const player = {
                x: 0,
                y: 0,
                width: 64,
                height: 64,
                speed: 5,
                facing: 'down',
                isMoving: false,
                hasBeenPositioned: false,
                inventory: [],
                
                initialize: function(canvasWidth, canvasHeight) {
                    console.log("Initializing player with canvas dimensions:", canvasWidth, "x", canvasHeight);
                    this.x = (canvasWidth - this.width) / 2;
                    this.y = (canvasHeight - this.height) / 2;
                    this.hasBeenPositioned = true;
                    return this;
                }
            };
            
            // Test initialization
            try {
                player.initialize(800, 600);
                console.log("Player initialized at position:", player.x, player.y);
                
                if (player.x === 368 && player.y === 268) {
                    console.log("Player positioned correctly in the center");
                } else {
                    console.warn("Player position might be incorrect");
                }
                
                if (player.hasBeenPositioned) {
                    console.log("Player hasBeenPositioned flag set correctly");
                } else {
                    console.warn("Player hasBeenPositioned flag not set");
                }
            } catch (error) {
                console.error("Error initializing player:", error);
            }
        }
        
        function testDomElements() {
            console.log("Testing DOM elements...");
            
            // Get iframe
            const iframe = document.getElementById('test-frame');
            iframe.style.display = 'block';
            iframe.src = 'about:blank';
            
            iframe.onload = function() {
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                doc.body.innerHTML = `
                    <div id="game-container" style="width:800px;height:600px;background:black;">
                        <canvas id="gameCanvas" width="800" height="600"></canvas>
                    </div>
                `;
                
                const gameContainer = doc.getElementById('game-container');
                const gameCanvas = doc.getElementById('gameCanvas');
                
                if (gameContainer && gameCanvas) {
                    console.log("Game container and canvas created successfully");
                    
                    // Test drawing on the canvas
                    const ctx = gameCanvas.getContext('2d');
                    ctx.fillStyle = 'green';
                    ctx.fillRect(350, 250, 100, 100);
                    ctx.fillStyle = 'white';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Test Successful', 400, 300);
                    
                    console.log("Canvas drawing successful");
                } else {
                    console.error("Failed to create game elements");
                }
                
                // Hide iframe after 5 seconds
                setTimeout(() => {
                    iframe.style.display = 'none';
                }, 5000);
            };
        }
        
        function checkResourceAvailability() {
            console.log("Checking resource availability...");
            
            // Check for JavaScript files
            const jsFiles = [
                'game.js',
                'start.js',
                'images.js',
                'logic-gates.js',
                'cutscene-images.js'
            ];
            
            jsFiles.forEach(file => {
                const script = document.createElement('script');
                script.src = file;
                script.onload = function() {
                    console.log(`✅ ${file} is available`);
                };
                script.onerror = function() {
                    console.error(`❌ ${file} is NOT available`);
                };
                document.head.appendChild(script);
                setTimeout(() => {
                    document.head.removeChild(script);
                }, 1000);
            });
            
            // Check for HTML files
            const htmlFiles = [
                'index.html',
                'fulife.html',
                'simple_game.html'
            ];
            
            htmlFiles.forEach(file => {
                fetch(file)
                    .then(response => {
                        if (response.ok) {
                            console.log(`✅ ${file} is available`);
                        } else {
                            console.warn(`⚠️ ${file} is available but returned status: ${response.status}`);
                        }
                    })
                    .catch(error => {
                        console.error(`❌ ${file} is NOT available:`, error);
                    });
            });
        }
        
        function runBlackScreenTests() {
            console.log("Running blank screen tests...");
            
            // Get iframe
            const iframe = document.getElementById('test-frame');
            iframe.style.display = 'block';
            iframe.src = 'about:blank';
            
            iframe.onload = function() {
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                doc.body.innerHTML = `
                    <div id="cutsceneContainer" style="width:800px;height:600px;background:blue;display:flex;">
                        <div>Cutscene Content</div>
                    </div>
                    <div id="game-container" style="width:800px;height:600px;background:black;display:none;">
                        <canvas id="gameCanvas" width="800" height="600"></canvas>
                    </div>
                `;
                
                console.log("Testing transition from cutscene to gameplay...");
                
                // Mock startGameplay function
                function mockStartGameplay() {
                    const cutsceneContainer = doc.getElementById("cutsceneContainer");
                    if (cutsceneContainer) {
                        cutsceneContainer.style.display = "none";
                        console.log("✅ Cutscene container hidden");
                    } else {
                        console.error("❌ Cutscene container not found");
                    }
                    
                    const gameContainer = doc.getElementById("game-container");
                    if (gameContainer) {
                        gameContainer.style.display = "block";
                        console.log("✅ Game container displayed");
                    } else {
                        console.error("❌ Game container not found");
                    }
                    
                    const canvas = doc.getElementById("gameCanvas");
                    if (canvas) {
                        canvas.style.display = "block";
                        const ctx = canvas.getContext('2d');
                        ctx.fillStyle = 'black';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        
                        // Draw player
                        ctx.fillStyle = 'blue';
                        ctx.fillRect(400 - 32, 300 - 32, 64, 64);
                        console.log("✅ Canvas prepared and player drawn");
                    } else {
                        console.error("❌ Canvas not found");
                    }
                }
                
                // Run the test
                setTimeout(() => {
                    console.log("Starting transition test...");
                    mockStartGameplay();
                    
                    setTimeout(() => {
                        const gameContainer = doc.getElementById("game-container");
                        const canvas = doc.getElementById("gameCanvas");
                        
                        if (gameContainer.style.display === "block" && canvas.style.display === "block") {
                            console.log("✅ Transition successful - game is visible");
                        } else {
                            console.error("❌ Transition failed - game is not visible");
                        }
                        
                        // Hide iframe after completion
                        setTimeout(() => {
                            iframe.style.display = 'none';
                        }, 2000);
                    }, 1000);
                }, 1000);
            };
        }
        
        // Initialize the test page
        window.addEventListener('load', function() {
            console.log("Test page initialized. Select a test to run.");
        });
    </script>
</body>
</html> 